{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Drew/Projects/bakers-math-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Drew/Projects/bakers-math-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/Drew/Projects/bakers-math-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/Drew/Projects/bakers-math-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{useEffect,useReducer}from\"react\";import config from\"../../Config\";// import { useAuth0 } from \"@auth0/auth0-react\";\nvar dataReducer=function dataReducer(state,action){switch(action.type){case\"FETCH_INIT\":return _objectSpread(_objectSpread({},state),{},{isLoading:true,isLoaded:false,isError:false});case\"FETCH_SUCCESS\":return _objectSpread(_objectSpread({},state),{},{isLoading:false,isLoaded:true,isError:false,data:action.payload});case\"FETCH_FAILURE\":return _objectSpread(_objectSpread({},state),{},{isLoading:false,isLoaded:false,isError:true,error:action.error});default:throw new Error();}};export var API_GET=function API_GET(endpointArr){var _useReducer=useReducer(dataReducer,{isLoading:true,isError:false,error:{},data:[]}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//   const { getAccessTokenSilently } = useAuth0();\nuseEffect(function(){var didCancel=false;var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var urls,token,responseArr,dispatchObj;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(endpointArr.length===0)){_context.next=2;break;}return _context.abrupt(\"return\",dispatch({type:\"FETCH_SUCCESS\",payload:{}}));case 2:dispatch({type:\"FETCH_INIT\"});urls=getUrls(endpointArr);_context.prev=4;if(didCancel){_context.next=14;break;}//   const token = await getAccessTokenSilently();\ntoken=process.env.REACT_APP_API_KEY;_context.next=9;return fetchResponseArr(urls,token);case 9:responseArr=_context.sent;_context.next=12;return getDispatchObj(responseArr);case 12:dispatchObj=_context.sent;dispatch(dispatchObj);case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](4);if(!didCancel)dispatch({type:\"FETCH_FAILURE\",error:{status:\"NA\",statusText:\"Failed to fetch resource\"}});case 19:case\"end\":return _context.stop();}}},_callee,null,[[4,16]]);}));return function getData(){return _ref.apply(this,arguments);};}();getData();return function(){didCancel=true;};},[endpointArr//  getAccessTokenSilently\n]);return[state,dispatch];};var getUrls=function getUrls(endpointArr){var urlArr=endpointArr.map(function(key){var url=\"\".concat(config.API_ENDPOINT,\"/\").concat(key);return url;});return urlArr;};var fetchResponseArr=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(urls,token){var responseArr;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(token);_context2.next=3;return Promise.all(urls.map(function(url){return fetch(url,{method:\"GET\",headers:{Authorization:\"Bearer \".concat(token),\"Content-Type\":\"application/json\"}});}));case 3:responseArr=_context2.sent;return _context2.abrupt(\"return\",responseArr);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchResponseArr(_x,_x2){return _ref2.apply(this,arguments);};}();var getDispatchObj=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(responseArr){var error,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:error=validateResponses(responseArr);if(!error.status){_context3.next=5;break;}return _context3.abrupt(\"return\",{type:\"FETCH_FAILURE\",error:error});case 5:_context3.next=7;return Promise.all(responseArr.map(function(res){return res.json();}));case 7:data=_context3.sent;return _context3.abrupt(\"return\",{type:\"FETCH_SUCCESS\",payload:data});case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function getDispatchObj(_x3){return _ref3.apply(this,arguments);};}();var validateResponses=function validateResponses(responseArr){var error={};responseArr.forEach(function(key){if(!key.ok){error={status:key.status,statusText:key.statusText};}});return error;};","map":{"version":3,"sources":["/Users/Drew/Projects/bakers-math-client/src/Utilities/APImethods/API_GET.js"],"names":["useEffect","useReducer","config","dataReducer","state","action","type","isLoading","isLoaded","isError","data","payload","error","Error","API_GET","endpointArr","dispatch","didCancel","getData","length","urls","getUrls","token","process","env","REACT_APP_API_KEY","fetchResponseArr","responseArr","getDispatchObj","dispatchObj","status","statusText","urlArr","map","key","url","API_ENDPOINT","console","log","Promise","all","fetch","method","headers","Authorization","validateResponses","res","json","forEach","ok"],"mappings":"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","sourcesContent":["import { useEffect, useReducer } from \"react\";\nimport config from \"../../Config\";\n// import { useAuth0 } from \"@auth0/auth0-react\";\n\nconst dataReducer = (state, action) => {\n  switch (action.type) {\n    case \"FETCH_INIT\":\n      return {\n        ...state,\n        isLoading: true,\n        isLoaded: false,\n        isError: false,\n      };\n    case \"FETCH_SUCCESS\":\n      return {\n        ...state,\n        isLoading: false,\n        isLoaded: true,\n        isError: false,\n        data: action.payload,\n      };\n    case \"FETCH_FAILURE\":\n      return {\n        ...state,\n        isLoading: false,\n        isLoaded: false,\n        isError: true,\n        error: action.error,\n      };\n    default:\n      throw new Error();\n  }\n};\n\nexport const API_GET = (endpointArr) => {\n  const [state, dispatch] = useReducer(dataReducer, {\n    isLoading: true,\n    isError: false,\n    error: {},\n    data: [],\n  });\n  //   const { getAccessTokenSilently } = useAuth0();\n\n  useEffect(() => {\n    let didCancel = false;\n\n    const getData = async () => {\n      if (endpointArr.length === 0)\n        return dispatch({ type: \"FETCH_SUCCESS\", payload: {} });\n\n      dispatch({ type: \"FETCH_INIT\" });\n      const urls = getUrls(endpointArr);\n      try {\n        if (!didCancel) {\n          //   const token = await getAccessTokenSilently();\n          const token = process.env.REACT_APP_API_KEY;\n          const responseArr = await fetchResponseArr(urls, token);\n          const dispatchObj = await getDispatchObj(responseArr);\n          dispatch(dispatchObj);\n        }\n      } catch (error) {\n        if (!didCancel)\n          dispatch({\n            type: \"FETCH_FAILURE\",\n            error: { status: \"NA\", statusText: \"Failed to fetch resource\" },\n          });\n      }\n    };\n    getData();\n    return () => {\n      didCancel = true;\n    };\n  }, [\n    endpointArr,\n    //  getAccessTokenSilently\n  ]);\n  return [state, dispatch];\n};\n\nconst getUrls = (endpointArr) => {\n  let urlArr = endpointArr.map((key) => {\n    let url = `${config.API_ENDPOINT}/${key}`;\n    return url;\n  });\n  return urlArr;\n};\n\nconst fetchResponseArr = async (urls, token) => {\n  console.log(token);\n  const responseArr = await Promise.all(\n    urls.map((url) => {\n      return fetch(url, {\n        method: \"GET\",\n        headers: {\n          Authorization: `Bearer ${token}`,\n          \"Content-Type\": \"application/json\",\n        },\n      });\n    })\n  );\n  return responseArr;\n};\n\nconst getDispatchObj = async (responseArr) => {\n  let error = validateResponses(responseArr);\n  if (error.status) {\n    return { type: \"FETCH_FAILURE\", error: error };\n  } else {\n    const data = await Promise.all(responseArr.map((res) => res.json()));\n    return { type: \"FETCH_SUCCESS\", payload: data };\n  }\n};\n\nconst validateResponses = (responseArr) => {\n  let error = {};\n  responseArr.forEach((key) => {\n    if (!key.ok) {\n      error = {\n        status: key.status,\n        statusText: key.statusText,\n      };\n    }\n  });\n  return error;\n};\n"]},"metadata":{},"sourceType":"module"}